@file:Suppress("SpellCheckingInspection")

package com.lhwdev.selfTestMacro.api

import com.lhwdev.selfTestMacro.*
import kotlinx.serialization.json.Json
import kotlinx.serialization.json.jsonObject
import kotlinx.serialization.json.jsonPrimitive
import java.net.URL


data class SurveyToken(val token: String)


suspend fun getSurveyToken(schoolInfo: SchoolInfo, user: UserInfo) = ioTask {
	fetch(
		URL(schoolInfo.requestUrl, "userrefresh"),
		method = HttpMethod.post,
		headers = sDefaultFakeHeader + mapOf("Content-Type" to ContentTypes.json, "Authorization" to user.token)
	).toResponseString().let { SurveyToken(Json.parseToJsonElement(it).jsonObject["UserInfo"]!!.jsonObject["token"]!!.jsonPrimitive.content) }
}